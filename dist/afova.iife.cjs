var afova=function(){"use strict";var e=Object.defineProperty,t=(t,s,r)=>((t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r)(t,"symbol"!=typeof s?s+"":s,r);const s={selector:"form",validateOnChange:!1,focusOnFirstError:!0},r=["submit","reset","button"];class n{constructor(){t(this,"settings",s),t(this,"constraints",{badInput:{message:"The input cannot be processed",constraintAttr:void 0},customError:{message:""},patternMismatch:{message:"The value does not match the required pattern of {{constraint}}",constraintAttr:"pattern"},rangeOverflow:{message:"The value is too big. It cannot be bigger than {{constraint}}.",constraintAttr:"max"},rangeUnderflow:{message:"The value is too small. It must be at least {{constraint}}.",constraintAttr:"min"},stepMismatch:{message:"The value is not in within the correct step interval of {{constraint}}",constraintAttr:"step"},tooLong:{message:"The value is too long. It cannot be longer than {{constraint}} characters.",constraintAttr:"maxlength"},tooShort:{message:"The value is too short. It must be at least {{constraint}} characters long.",constraintAttr:"minlength"},typeMismatch:{message:"The value must be of type {{constraint}}",constraintAttr:"type"},"typeMismatch[email]":{message:"The value must be an email in the format mickey@mouse.com",constraintAttr:"type"},"typeMismatch[url]":{message:"The value must be a URL in the format http://url.com",constraintAttr:"type"},"typeMismatch[tel]":{message:"The value must be a phone number",constraintAttr:"type"},valid:{message:""},valueMissing:{message:"Please provide a value",constraintAttr:"required"}})}setOptions(e){e&&(this.settings=Object.assign(this.settings,e))}ensureId(e){e.id||(e.id=`afova-${((e=21)=>{let t="",s=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&s[e]];return t})()}`)}findMessageContainer(e){return document.querySelector(`#${e.id}-afova-message-container`)}ensureAndGetMessageContainer(e){var t;let s=this.findMessageContainer(e);return s||(s=document.createElement("ul"),null==(t=e.parentNode)||t.insertBefore(s,e),s.id=`${e.id}-afova-message-container`,s.classList.add("afova-message-container"),e.setAttribute("aria-errormessage",s.id)),s}deriveMessageText(e,t){if("customError"!=e){let s=this.constraints[e];if(s){let r=s.message,n=s.constraintAttr;const o=t.getAttribute(n||"");if(r=t.dataset[n||e]||r,o){s=this.constraints[`${e}[${e.toLowerCase()}]`],s&&(r=t.dataset[e]||s.message);const n=new RegExp("{{\\s*constraint\\s*}}","ig");r=r.replace(n,o)}return r}}return t.validationMessage}putMessage(e){const t=this.ensureAndGetMessageContainer(e),s=e.validity,r=document.createElement("li");r.classList.add("afova-message"),r.classList.add("derived"),t.appendChild(r);for(const n of Object.keys(this.constraints))if(s[n]){let t=this.deriveMessageText(n,e);t&&(r.innerHTML=t);break}r.innerHTML||(r.innerHTML=e.dataset.errorInvalid||"The value is not correct")}clearControlMessages(e){e.classList.remove("afova-active"),e.classList.remove("afova-control"),e.removeAttribute("aria-invalid"),e.removeAttribute("aria-errormessage");const t=this.findMessageContainer(e);t&&t.remove();let s=this.getContext(e);s&&s.classList.remove("afova-active")}setControlMessage(e,t){const s=this.getContext(e);s&&s.classList.add("afova-active"),e.classList.add("afova-active"),e.setAttribute("aria-invalid","true"),this.putMessage(e),t&&e.focus()}validateControl(e,t){return this.clearControlMessages(e),e.validity.valid||this.setControlMessage(e,t),e.validity.valid}getFormElements(e){const t=[];for(const s of e.elements)r.includes(s.type)||t.push(s);return t}validateForm(e,t){let s;for(const r of this.getFormElements(e)){const e=this.validateControl(r);s||e||(s=r)}s&&(null==t||t.preventDefault(),this.settings.focusOnFirstError&&s.focus())}resetForm(e){for(let t of this.getFormElements(e))this.clearControlMessages(t)}prepareForms(){console.log("prepare forms");let e="form";this.settings.selector&&(e=this.settings.selector);const t=document.querySelectorAll(e);for(const s of t){console.log("prepare form",s),s.setAttribute("novalidate",""),this.ensureId(s),s.addEventListener("submit",this.formSubmitListener.bind(this)),s.addEventListener("reset",this.formResetListener.bind(this));for(const e of this.getFormElements(s))this.prepareControl(e)}}formSubmitListener(e){this.validateForm(e.target,e)}formResetListener(e){this.resetForm(e.target)}unprepareForms(){let e="form";this.settings.selector&&(e=this.settings.selector);const t=document.querySelectorAll(e);for(const s of t){s.removeAttribute("novalidate"),s.removeEventListener("submit",this.formSubmitListener),s.removeEventListener("reset",this.formResetListener);for(const e of this.getFormElements(s))this.unprepareControl(e)}}prepareControl(e){console.log("prepare control",e),this.ensureId(e),e.classList.add("afova-control"),this.settings.validateOnChange&&e.addEventListener("change",this.controlChangeListener.bind(this))}controlChangeListener(e){this.validateControl(e.target,!0)}unprepareControl(e){e.classList.remove("afova-control"),e.removeEventListener("change",this.controlChangeListener)}getContext(e){let t=e.closest(".afova-context");return t||(t=e.closest("label"),t&&!t.htmlFor&&(t.htmlFor=e.id)),t}prepare(e){this.setOptions(e),console.log("settings",this.settings),this.prepareForms()}clear(){this.unprepareForms()}validate(){let e="form";this.settings.selector&&(e=this.settings.selector);const t=document.querySelectorAll(e);for(const s of t)this.validateForm(s)}isInvalid(){let e="form";this.settings.selector&&(e=this.settings.selector);const t=document.querySelectorAll(e);for(const s of t)if(!s.checkValidity())return!0;return!1}}return function(){const e=new n;return{prepare:t=>e.prepare(t),clear:()=>e.clear(),validate:()=>e.validate(),isInvalid:()=>e.isInvalid()}}()}();
